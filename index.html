<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Family Wallet Pro</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        
        :root {
            --apple-bg: #f5f5f7;
            --apple-card: rgba(255, 255, 255, 0.8);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--apple-bg);
            color: #1d1d1f;
            letter-spacing: -0.02em;
        }

        .glass-card {
            background: var(--apple-card);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .ios-shadow {
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.04);
        }

        .safe-top { padding-top: env(safe-area-inset-top); }
        
        /* Smooth tab transitions */
        .tab-content { transition: opacity 0.3s ease; }
        
        /* Custom scrollbar for elite feel */
        ::-webkit-scrollbar { width: 0px; }

        input, select {
            outline: none !important;
            transition: all 0.2s ease;
        }

        .active-tab { color: #007AFF !important; }
    </style>
</head>
<body class="antialiased">

    <div id="login-screen" class="fixed inset-0 bg-white z-[100] flex flex-col items-center justify-center p-10">
        <div class="w-20 h-20 bg-gradient-to-tr from-blue-600 to-cyan-400 rounded-[2rem] shadow-2xl shadow-blue-200 flex items-center justify-center mb-8 rotate-3">
            <i data-lucide="wallet" class="w-10 h-10 text-white"></i>
        </div>
        <h1 class="text-4xl font-extrabold tracking-tight mb-2">Wallet Pro</h1>
        <p class="text-slate-400 font-medium mb-12">Elegant family finance.</p>
        <button onclick="login()" class="w-full max-w-xs bg-[#1d1d1f] text-white py-4 rounded-2xl font-semibold flex items-center justify-center gap-3 active:scale-95 transition shadow-xl">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" class="w-5 h-5">
            Continue with Google
        </button>
    </div>

    <div id="app-ui" class="hidden min-h-screen pb-32">
        <nav class="safe-top sticky top-0 z-40 glass-card border-b px-6 py-4 flex justify-between items-center">
            <button onclick="toggleSidebar()" class="w-10 h-10 flex items-center justify-center rounded-full bg-slate-100/50">
                <i data-lucide="align-left" class="w-5 h-5 text-slate-600"></i>
            </button>
            
            <div class="flex items-center gap-2 bg-slate-200/50 px-4 py-2 rounded-full border border-white/50">
                <input type="month" id="globalMonth" class="bg-transparent font-bold text-sm border-none p-0 w-24 text-center" onchange="loadData()">
            </div>

            <img id="user-photo" class="w-10 h-10 rounded-full border-2 border-white shadow-sm">
        </nav>

        <div id="sidebar" class="fixed inset-0 bg-black/20 backdrop-blur-md z-50 -translate-x-full transition-all duration-500 opacity-0">
            <div class="w-72 h-full bg-white p-8 shadow-2xl">
                <button onclick="toggleSidebar()" class="text-slate-400 mb-12 font-bold uppercase text-xs tracking-widest">Close</button>
                <div class="space-y-8">
                    <button onclick="switchTab('expenses')" class="flex items-center gap-4 text-2xl font-bold text-slate-900"><i data-lucide="layout-grid"></i> Monthly</button>
                    <button onclick="switchTab('savings')" class="flex items-center gap-4 text-2xl font-bold text-slate-900"><i data-lucide="pie-chart"></i> Wealth</button>
                    <button onclick="logout()" class="flex items-center gap-4 text-xl font-bold text-rose-500 pt-12"><i data-lucide="log-out"></i> Logout</button>
                </div>
            </div>
        </div>

        <main class="px-6 pt-8 max-w-xl mx-auto space-y-8">
            
            <div id="tab-expenses" class="space-y-8">
                <div class="text-center py-4">
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Available to Save</p>
                    <h1 id="display-net-savings" class="text-6xl font-extrabold tracking-tighter text-slate-900">₹0</h1>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="glass-card ios-shadow p-6 rounded-[2rem]">
                        <p class="text-[10px] font-bold text-blue-500 uppercase mb-1">Income</p>
                        <p id="display-total-income" class="text-2xl font-extrabold text-slate-900">₹0</p>
                    </div>
                    <div class="glass-card ios-shadow p-6 rounded-[2rem]">
                        <p class="text-[10px] font-bold text-rose-500 uppercase mb-1">Spent</p>
                        <p id="display-total-expenses" class="text-2xl font-extrabold text-slate-900">₹0</p>
                    </div>
                </div>

                <div class="bg-[#1d1d1f] p-6 rounded-[2.5rem] shadow-2xl">
                    <div class="flex flex-col gap-4">
                        <div class="flex items-center justify-between border-b border-white/10 pb-4">
                            <span class="text-white/50 text-xs font-bold uppercase tracking-wider">Quick Add</span>
                            <select id="exp-cat" class="bg-transparent text-white font-bold text-sm border-none ring-0"></select>
                        </div>
                        <div class="flex gap-4">
                            <input type="number" id="exp-amt" placeholder="0.00" class="flex-1 bg-transparent text-white text-3xl font-bold border-none placeholder:text-white/20">
                            <button onclick="addExpense()" class="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg active:scale-90 transition">
                                <i data-lucide="plus"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between gap-3 px-2">
                    <div class="text-center flex-1">
                        <label class="text-[9px] font-bold text-slate-400 uppercase">Husband</label>
                        <input type="number" id="inc-husband" onchange="saveIncome()" class="w-full bg-white rounded-xl py-2 text-center font-bold text-sm ios-shadow border border-slate-100">
                    </div>
                    <div class="text-center flex-1">
                        <label class="text-[9px] font-bold text-slate-400 uppercase">Wife</label>
                        <input type="number" id="inc-wife" onchange="saveIncome()" class="w-full bg-white rounded-xl py-2 text-center font-bold text-sm ios-shadow border border-slate-100">
                    </div>
                    <div class="text-center flex-1">
                        <label class="text-[9px] font-bold text-slate-400 uppercase">Other</label>
                        <input type="number" id="inc-other" onchange="saveIncome()" class="w-full bg-white rounded-xl py-2 text-center font-bold text-sm ios-shadow border border-slate-100">
                    </div>
                </div>

                <div id="budget-list" class="space-y-4"></div>
            </div>

            <div id="tab-savings" class="hidden space-y-8">
                <div class="py-8 text-center">
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Total Net Worth</p>
                    <h1 id="lifetime-savings" class="text-6xl font-extrabold tracking-tighter text-slate-900">₹0</h1>
                </div>
                <div id="saving-tiles" class="grid grid-cols-1 gap-4"></div>
            </div>

        </main>
    </div>

    <div id="expense-detail-view" class="fixed inset-0 bg-white/90 backdrop-blur-xl z-[70] hidden p-8 pt-24 overflow-y-auto transition-all">
        <div class="max-w-md mx-auto">
            <div class="flex justify-between items-end mb-12">
                <h2 id="detail-cat-name" class="text-5xl font-extrabold tracking-tighter">History</h2>
                <button onclick="closeExpenseDetails()" class="w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center font-bold text-2xl">×</button>
            </div>
            <div id="daily-log-list" class="space-y-4"></div>
        </div>
    </div>

    <div id="saving-detail-view" class="fixed inset-0 bg-white/90 backdrop-blur-xl z-[70] hidden p-8 pt-24 overflow-y-auto">
        <div class="max-w-md mx-auto">
            <div class="flex justify-between mb-8"><h3 id="selected-saving-title" class="text-4xl font-extrabold tracking-tight">Saving</h3><button onclick="closeSavingDetails()" class="text-3xl">×</button></div>
            <div class="space-y-4 mb-8">
                <input type="date" id="sav-date" class="w-full p-5 bg-slate-100 rounded-[1.5rem] border-none font-bold">
                <input type="number" id="sav-amt" placeholder="₹ Amount" class="w-full p-5 bg-slate-100 rounded-[1.5rem] border-none font-black text-2xl">
                <textarea id="sav-note" placeholder="Write a note..." class="w-full p-5 bg-slate-100 rounded-[1.5rem] border-none text-sm"></textarea>
                <button onclick="addSavingLog()" class="w-full bg-blue-600 text-white py-5 rounded-[1.5rem] font-bold shadow-xl shadow-blue-200">Record Entry</button>
            </div>
            <div id="saving-log-list" class="space-y-3"></div>
        </div>
    </div>

    <script>
        // FIREBASE SETUP
        const firebaseConfig = {
            apiKey: "AIzaSyDy9Zx7MOhRFJc72HA_3bHqwsCUjjvWduA",
            authDomain: "family-pocket-41cee.firebaseapp.com",
            projectId: "family-pocket-41cee",
            storageBucket: "family-pocket-41cee.firebasestorage.app",
            messagingSenderId: "376381204269",
            appId: "1:376381204269:web:4a9c4ebfe8aa09a1f395a4"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(), db = firebase.firestore(), provider = new firebase.auth.GoogleAuthProvider();
        
        let currentUser = null, userData = { months: {}, savings: { "Gold": [], "FD": [], "Stocks": [], "Post Office": [] } }, currentMonth = new Date().toISOString().slice(0, 7);
        
        const categories = [
            { name: "Petrol", icon: "fuel" }, { name: "EMI", icon: "home" }, 
            { name: "Essentials", icon: "shopping-basket" }, { name: "News paper", icon: "newspaper" },
            { name: "Donations", icon: "heart" }, { name: "Sports", icon: "trophy" },
            { name: "Outside Food", icon: "utensils" }, { name: "Office tea", icon: "coffee" },
            { name: "Recharge", icon: "zap" }, { name: "Taxi", icon: "car" },
            { name: "Parents", icon: "users" }, { name: "Entertainment", icon: "clapperboard" },
            { name: "Others", icon: "plus-circle" }
        ];

        auth.onAuthStateChanged(async (u) => { 
            if(u){ 
                currentUser=u; 
                document.getElementById('login-screen').classList.add('hidden'); 
                document.getElementById('app-ui').classList.remove('hidden'); 
                document.getElementById('user-photo').src = u.photoURL;
                await syncFromCloud(); 
                render(); 
            } 
        });

        function login() { auth.signInWithPopup(provider); }
        function logout() { auth.signOut().then(() => location.reload()); }
        async function syncFromCloud() { const doc = await db.collection('users').doc(currentUser.uid).get(); if(doc.exists) userData = doc.data(); loadData(); }
        async function syncToCloud() { if(currentUser) await db.collection('users').doc(currentUser.uid).set(userData); }
        
        function loadData() {
            currentMonth = document.getElementById('globalMonth').value;
            if(!userData.months[currentMonth]) userData.months[currentMonth] = { income:{husband:0,wife:0,other:0}, spends:[], budgets:{} };
            const m = userData.months[currentMonth];
            document.getElementById('inc-husband').value = m.income.husband || '';
            document.getElementById('inc-wife').value = m.income.wife || '';
            document.getElementById('inc-other').value = m.income.other || '';
            render();
        }

        function toggleSidebar() { 
            const s = document.getElementById('sidebar');
            const open = s.classList.contains('-translate-x-full');
            s.classList.toggle('-translate-x-full', !open);
            s.classList.toggle('opacity-0', !open);
            s.classList.toggle('opacity-100', open);
        }

        function switchTab(t) {
            document.getElementById('tab-expenses').classList.toggle('hidden', t!=='expenses');
            document.getElementById('tab-savings').classList.toggle('hidden', t!=='savings');
            toggleSidebar();
            render();
        }

        async function saveIncome() {
            const m = userData.months[currentMonth];
            m.income.husband = parseFloat(document.getElementById('inc-husband').value)||0;
            m.income.wife = parseFloat(document.getElementById('inc-wife').value)||0;
            m.income.other = parseFloat(document.getElementById('inc-other').value)||0;
            await syncToCloud(); render();
        }

        async function addExpense() {
            const cat = document.getElementById('exp-cat').value, amt = parseFloat(document.getElementById('exp-amt').value);
            if(!amt) return;
            userData.months[currentMonth].spends.push({ cat, amt, date: new Date().toLocaleDateString('en-GB') });
            document.getElementById('exp-amt').value = ''; await syncToCloud(); render();
        }

        async function updateBudget(cat, val, e) {
            e.stopPropagation(); userData.months[currentMonth].budgets[cat] = parseFloat(val)||0;
            await syncToCloud(); render();
        }

        function render() {
            const mData = userData.months[currentMonth]; if(!mData) return;
            const inc = Object.values(mData.income).reduce((a,b)=>a+b,0), exp = mData.spends.reduce((a,b)=>a+b.amt,0);
            document.getElementById('display-total-income').innerText = `₹${inc.toLocaleString()}`;
            document.getElementById('display-total-expenses').innerText = `₹${exp.toLocaleString()}`;
            document.getElementById('display-net-savings').innerText = `₹${(inc-exp).toLocaleString()}`;
            document.getElementById('exp-cat').innerHTML = categories.map(c=>`<option value="${c.name}">${c.name}</option>`).join('');
            
            const blist = document.getElementById('budget-list'); blist.innerHTML = '';
            categories.forEach(c => {
                const s = mData.spends.filter(x=>x.cat===c.name).reduce((a,b)=>a+b.amt,0), b = mData.budgets[c.name]||0;
                const d = document.createElement('div');
                d.className = `glass-card ios-shadow p-6 rounded-[2rem] flex justify-between items-center`;
                d.onclick = () => openExpenseDetails(c.name);
                d.innerHTML = `<div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center text-slate-500"><i data-lucide="${c.icon}" class="w-5 h-5"></i></div>
                    <div><p class="text-[10px] font-bold uppercase text-slate-400 tracking-wider">${c.name}</p><p class="text-xl font-extrabold text-slate-900">₹${(b-s).toLocaleString()}</p></div>
                    </div>
                    <input type="number" value="${b}" onchange="updateBudget('${c.name}', this.value, event)" onclick="event.stopPropagation()" class="w-20 bg-slate-100/50 p-2 rounded-xl text-center text-sm font-bold border-none">`;
                blist.appendChild(d);
            });

            const sTiles = document.getElementById('saving-tiles'); sTiles.innerHTML = '';
            let totalS = 0; const sIcons = {"Gold":"gem","FD":"landmark","Stocks":"trending-up","Post Office":"mail"};
            Object.keys(userData.savings).forEach(cat => {
                const total = userData.savings[cat].reduce((a,b)=>a+b.amt,0); totalS += total;
                const t = document.createElement('div');
                t.className = `glass-card ios-shadow p-8 rounded-[2.5rem] flex justify-between items-center`;
                t.onclick = () => openSavingDetails(cat);
                t.innerHTML = `<div class="flex items-center gap-5">
                    <div class="w-14 h-14 bg-indigo-50 rounded-2xl flex items-center justify-center text-indigo-600"><i data-lucide="${sIcons[cat]}" class="w-6 h-6"></i></div>
                    <div><p class="text-xs font-bold text-slate-400 uppercase tracking-widest">${cat}</p><p class="text-3xl font-extrabold text-slate-900">₹${total.toLocaleString()}</p></div>
                    </div><i data-lucide="chevron-right" class="text-slate-300"></i>`;
                sTiles.appendChild(t);
            });
            document.getElementById('lifetime-savings').innerText = `₹${totalS.toLocaleString()}`;
            lucide.createIcons();
        }

        function openExpenseDetails(c) {
            const logs = userData.months[currentMonth].spends.filter(s=>s.cat===c);
            document.getElementById('detail-cat-name').innerText = c;
            document.getElementById('daily-log-list').innerHTML = logs.reverse().map((l,i)=>`<div class="flex justify-between items-center p-6 bg-slate-50 rounded-[1.5rem] border border-white"><div><p class="text-xl font-bold">₹${l.amt.toLocaleString()}</p><p class="text-xs text-slate-400 font-bold uppercase tracking-widest">${l.date}</p></div><button onclick="deleteExp('${c}',${logs.length-1-i})" class="text-rose-500 font-bold text-sm">Delete</button></div>`).join('');
            document.getElementById('expense-detail-view').classList.remove('hidden');
            lucide.createIcons();
        }

        function closeExpenseDetails() { document.getElementById('expense-detail-view').classList.add('hidden'); }
        
        async function deleteExp(c,idx) { 
            let count=0, m=userData.months[currentMonth];
            for(let i=0;i<m.spends.length;i++){ if(m.spends[i].cat===c){ if(count===idx){m.spends.splice(i,1); break;} count++; } }
            await syncToCloud(); render(); closeExpenseDetails(); 
        }

        let activeS = '';
        function openSavingDetails(c) { activeS=c; document.getElementById('selected-saving-title').innerText=c; document.getElementById('saving-detail-view').classList.remove('hidden'); renderSLogs(); }
        function closeSavingDetails() { document.getElementById('saving-detail-view').classList.add('hidden'); }
        
        async function addSavingLog() {
            const a=parseFloat(document.getElementById('sav-amt').value), d=document.getElementById('sav-date').value, n=document.getElementById('sav-note').value;
            if(!a||!d) return; userData.savings[activeS].push({amt:a,date:d,note:n});
            await syncToCloud(); render(); renderSLogs();
        }

        function renderSLogs() {
            document.getElementById('saving-log-list').innerHTML = userData.savings[activeS].slice().reverse().map(l=>`<div class="p-6 bg-slate-50 rounded-[1.5rem] border border-white"><p class="text-xl font-bold">₹${l.amt.toLocaleString()}</p><p class="text-xs text-slate-400 font-bold mb-2">${l.date}</p><p class="text-sm text-slate-600">${l.note}</p></div>`).join('');
        }

        document.getElementById('globalMonth').value = currentMonth; lucide.createIcons();
    </script>
</body>
</html>

